{{ if (.Values.cmkey.enable) }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ template "eric-cm-mediator.name" . }}-hook
  labels: {{- include "eric-cm-mediator.labels" . | nindent 4 }}
  annotations:
    {{- $annotationsDict := dict }}
    {{- $_ := set $annotationsDict "helm.sh/hook" "pre-install,pre-upgrade,pre-rollback" }}
    {{- $_ := set $annotationsDict "helm.sh/hook-weight" "-10" }} {{/* must be created before the cm key cleanup job */}}

    {{- $baseAnnotations := include "eric-cm-mediator.baseAnnotations" . | fromYaml  -}}
    {{- include "eric-cm-mediator.mergeAnnotations" (dict "location" .Template.Name "sources" (list $annotationsDict $baseAnnotations)) | trim | nindent 4 }}
{{- end }}