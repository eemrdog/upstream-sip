{{- $g := fromJson (include "eric-pm-bulk-reporter.global" .) -}}
[unix_http_server]
file=/tmp/supervisor.sock

[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
logfile_backups=1

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:container_cleanup]
command=/sbin/container-cleanup.sh
autostart=true
autorestart=false
redirect_stderr=true
stdout_logfile=/var/log/superv-container-cleanup.log
stdout_logfile_backups=1
startsecs=0
priority=10

[program:rsyslogd]
command=/usr/sbin/rsyslogd -4 -n
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/superv-rsyslogd.log
stdout_logfile_backups=1
priority=100

[program:logctl]
command=/usr/bin/tail -F /var/log/messages
autostart=false
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
priority=200

[program:sssd]
command=/etc/init.d/sssd start
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/superv-sssd.log
stdout_logfile_backups=1
priority=300

[program:restartsssd]
{{- if and .Values.security.tls.ldapServer.enabled $g.security.tls.enabled }}
command=/usr/bin/reloadsssd -d /run/secrets/cacert -d /run/secrets/ldap-client-cert -c "/usr/bin/supervisorctl restart sssd"
{{- else }}
command=/usr/bin/reloadsssd_simple_bind
{{- end }}
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/superv-sssd.log
stdout_logfile_backups=1
priority=300

[program:sshd]
environment = LD_PRELOAD="/usr/lib64/libaudit_stub.so"
command=/usr/sbin/sshd -D
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/superv-sshd.log
stdout_logfile_backups=1
priority=300

[program:crond]
command=/usr/bin/taskscheduler 1 0 0 "daily"
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/superv-crond.log
stdout_logfile_backups=1
priority=400

[program:initenv]
command=/initenv
autostart=true
autorestart=false
stdout_syslog=true
stderr_syslog=true
priority=500
