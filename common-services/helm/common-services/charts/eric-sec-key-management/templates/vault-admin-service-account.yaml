# Service account that can be used to fetch credentials from vault

apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ template "eric-sec-key-management.name" . }}-admin
  labels:
    {{- include "eric-sec-key-management.labels" . | nindent 4 }}
  annotations:
    {{- include "eric-sec-key-management.annotations" . | nindent 4 }}

---

# Explicitly created secret that refers above service account.
# Will be populated with the service account token.

apiVersion: v1
kind: Secret
metadata:
  name: {{ template "eric-sec-key-management.name" . }}-admin
  labels:
    {{- include "eric-sec-key-management.labels" . | nindent 4 }}
  annotations:
    {{- $svcAcc := dict -}}
    {{- $_ := set $svcAcc "kubernetes.io/service-account.name" (printf "%s-admin" (include "eric-sec-key-management.name" .)) -}}
    {{- $commonAnn := include "eric-sec-key-management.annotations" . | fromYaml -}}
    {{- include "eric-sec-key-management.mergeAnnotations" (dict "location" .Template.Name "sources" (list $svcAcc $commonAnn)) | trim | nindent 4 }}
type: kubernetes.io/service-account-token