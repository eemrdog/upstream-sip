{{- $globals := fromJson (include "eric-sec-sip-tls.global" .) -}}
{{- if and $globals.networkPolicy.enabled .Values.networkPolicy.known.enabled -}}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: {{ template "eric-sec-sip-tls.name" . }}-pm-allow
  labels:
    {{- include "eric-sec-sip-tls.labels" . | nindent 4 }}
  annotations:
    {{- include "eric-sec-sip-tls.annotations" . | indent 4 }}
spec:
  podSelector:
    matchLabels:
      app: {{ template "eric-sec-sip-tls.name" . }}
  policyTypes:
  - Ingress
  ingress:
    # Allow inbound connections
    - from:
      - podSelector:
          matchLabels:
            app: {{ .Values.pm.serviceName }}
      ports:
      - port: {{ template "eric-sec-sip-tls.metrics.server.port" . }}
        protocol: tcp
{{- end }}