{{ if .Values.authenticationProxy.enabled }}
{{- $global := fromJson (include "eric-sec-access-mgmt.global" .) -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ template "eric-sec-access-mgmt.name" . }}-authn
  labels:
    {{- include "eric-sec-access-mgmt.labels" . | indent 4 }}
  annotations:
    {{- include "eric-sec-access-mgmt.common-annotations" . | nindent 4 }}
    {{ if $global.security.tls.enabled }}
    projectcontour.io/upstream-protocol.tls: "http, 8080"
    {{ end }}
spec:
  {{- if $global.internalIPFamily }}
  ipFamilies: [{{ $global.internalIPFamily | quote }}]
  {{- end }}
  type: ClusterIP
  ports:
    - protocol: TCP
      name: http
      port: 8080
      targetPort: http-pxy
  selector:
    app: {{ template "eric-sec-access-mgmt.name" . }}
    release: {{ .Release.Name | quote }}
status:
  loadBalancer: {}
{{ end }}
