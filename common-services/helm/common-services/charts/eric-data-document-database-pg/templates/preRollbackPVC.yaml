{{- if or .Release.IsUpgrade .Release.IsInstall }}
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ template "eric-data-document-database-pg.name" . }}-backup-pgdata
  labels:
{{- include "eric-data-document-database-pg.labels" . | indent 4 }}
    app: {{ template "eric-data-document-database-pg.name" . }}
    release: {{ .Release.Name | quote }}
    cluster-name: {{ template "eric-data-document-database-pg.name" . }}
    ## workaround after migrate from helm2 to helm3. Avoid upgrade fail. ADPPRG-26626
    heritage: Tiller
{{- include "eric-data-document-database-pg_app_kubernetes_io_info" .| nindent 4 }}
  annotations:
    ericsson.com/product-name: {{ template "eric-data-document-database-pg.helm-annotations_product_name" . }}
    ericsson.com/product-number: {{ template "eric-data-document-database-pg.helm-annotations_product_number" . }}
    ericsson.com/product-revision: {{ template "eric-data-document-database-pg.helm-annotations_product_revision" . }}
    "helm.sh/hook": pre-rollback
    "helm.sh/hook-delete-policy": before-hook-creation
    "helm.sh/hook-weight": "-5"
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ template "eric-data-document-database-pg.persistentVolumeClaim.size" . }}
  storageClassName: {{ template "eric-data-document-database-pg.persistentVolumeClaim.defaultStorageClassName" . }}
{{- end }}
